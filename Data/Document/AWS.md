[뒤로가기](../../README.md)

# AWS

(AWS 강의실 영상을 참고해 정리함 )<br>

200개가 넘는 데이터센터로 완벽한 기능의 서비스를 제공하는 클라우드 플랫폼<br>

## 구조

AWS Cloud는 각 나라 별(리전)로 가용 영역을 제공하며
글로벌 서비스로는 IAM, Amazon CloudFront
리전영역에 속하지만 가용영역에는 없는 VPC, S3가 있다.
![image](../Img/222.png)
리전 : AWS의 서비스가 제공되는 서버의 물리적 위치
전 세계에 흩어져 있으며 각 리전마다 코드가 부여됨<br>
예시) 서울 리전은 ap-northeast-2<br>
리전(지역) 별로 지원하는 서비스가 다르다.<br>

리전을 선택할때 고려할 점)<br>

1. 지연 속도
2. 국가 정책 (데이터, 서비스 제공)
3. 사용 가능한 AWS 서비스

가용 영역 : 리전의 하부 단위 (데이터 센터 건물)<br>
가용 영역들의 연결은 매우 빠른 네크워크로 연결되며 반드시 일정 거리 만큼 떨어져 있다. (재해, 보안을 대비하기 위해)

엣지 로케이션 : 임시 데이터 저장소 (CDN)

AWS는 서비스가 제공되는 지역의 기반에 따라 글로벌 서비스와 리전 서비스로 분류 한다.<br>
글로벌 서비스 : 데이터 및 서비스를 전 세계의 모든 인프라가 공유

1. CloudFront
2. IAM
3. Route53
4. WAF<br>

지역 서비스 : 특정 리전을 기반으로 데이터 및 서비스를 제공

1. S3(파일을 저장하는 서비스) : 전 세계에 동일하게 사용하나 데이터 자체는 리전에 종속
2. 그외 서비스들

ARN : AWS 모든 리소스의 고유 아이디

## AWS 기본 환경

![img](../Img/231.png)

## 사용자

루트 유저<br>

생성한 계정의 모든 권한을 가진 유저<br>
생성시 만든 이메일 주소로 로그인<br>
잃어버릴 경우 복구가 힘들기에 MFA 설정이 필수<br>
루트 유저는 관리용으로만 이용한다. (계정 설정 변경, 빌링 등등)<br>
AWS API 호출 불가 (액세스 키, 스크릿 키 부여 불가)<br>

IAM 유저<br>

IAM을 통해 생성한 유저
만들 때 주어진 아이디로 로그인<br>
기본 권한이 없어 따로 권한을 부여해야 한다.<br>
예시) 관리자 IAM, 개발자 IAM, 디자이너 IAM, 회계팀 IAM <br>
AWS API 호출 가능<br>
액세스 키 : 아이디<br>
시크릿 키 : 패스워드<br>
AWS의 관리를 제외한 모든 작업은 관리용 IAM 유저를 만들어 사용한다.<br>

---

## IAM (AWS Identity and Access Management)

AWS 서비스와 리소스에 대한 액세스를 안전하게 관리할 수 있다.<br>

1. AWS 계정 관리 및 리소스, 사용자, 서비스 권한 제어 (서비스 사용 인증 정보 부여)
2. 사용자의 생성 및 관리 및 계정 보안 (일정 시간마다 사용자의 패스워드를 변경할 수 있다.)
3. 다른 계정과의 리소스 공유
4. 계정 별명 부여 가능 (로그인 주소 생성 가능)
5. IAM은 글로벌 서비스임

[IAM 구성]
![img](../Img/IAM.png)

1. 사용자 : 실제 AWS를 사용하는 유저
2. 그룹 : 유저 집합, 그룹에 속한 유저에 따라 권한 부여
3. 정책 : 유저의 역할에 관한 문서 (JSON형식으로 정의)
4. 역할 <br>
   (1) AWS 리소스에 부여하여 AWS 리소스가 무엇을 할 수 있는지 정의<br>
   (2) 다른 사용자가 역할을 부여 받아 사용<br>
   (3) 다른 자격에 대해서 신뢰관계를 구축 가능<br>
   (4) 역할을 바꾸며 서비스 사용 가능<br>

IAM 권한 검증 과정1
![img](../Img/IAM%EA%B6%8C%ED%95%9C%20%EA%B2%80%EC%A6%9D.png)
IAM 권한 검증 과정2
![img](../Img/IAM%EA%B6%8C%ED%95%9C%20%EA%B2%80%EC%A6%9D2.png)

### IAM 자격 증명 보고서<br>

![img](../Img/IAM%EC%9E%90%EA%B2%A9%EC%A6%9D%EB%AA%85.png)
계정의 모든 사용자, 암호, 액세스키, MFA장치등의 증명 상태를 문서화한 보고서<br>
4시간 단위로 생성 가능하며, AWS 콘솔, CLI, API에서 생성 요청 및 다운로드 가능<br>

### IAM을 사용할때 주의 사항<br>

1. 루트 계정은 사용하지 않는다.
2. 불필요한 유저 만들기 않기
3. 그룹과 정책을 사용한다.
4. 최소한의 권한만 부여
5. MFA 활성화
6. 액세스키 대신 역할을 활용 (되도록 액세스키는 사용하지 않는다.)
7. IAM 자격 증명 보고서 활용

## [계정 설정 방법](./AWSaccount.md)

---

## 가상화

단일 컴퓨터의 하드웨어 요소를 일반적으로 VM이라고 하는
다수의 가상 컴퓨터로 분할하는 기술<br>

HVM : 3세대 가상화 머신(하드웨어에서 직접 가상화를 지원)<br>
직접 OS가 하드웨어와 통신에 속도가 빠르다.<br>

AWS 클라우드 환경에서 리소스를 작은 단위로 빠르게 구성할 수 있는 원동력은 가상화<br>

## EC2

안전하고 크기 조정이 가능한 컴퓨팅 파워를 클라우드에서 제공하는 웹 서비스<br>

용도 : 서버, 데이터베이스, 머신 러닝, 비트 코인 채굴, 연구용 프로그램<br>

구성<br>
인스턴스 - 컴퓨팅<br>
하드디스크 - EBS<br>
랜카드 - ENI<br>

EC2 가격 모델<br>
(1) on-Demand : 초당 컴퓨팅 파워로 측정된 가격 지불
(쓴 만큼 지불)<br>
(2) Spot-Instance : 경매 형식으로 시장에 남은 인스턴스를 싸게 구매하는 방식 단, 언제 다시 반납될지 모름<br>
(3) 예약 인스턴스 : 미리 일정 기간 약정해서 쓰는 방식<br>
(4) 전용 호스트 : 실제 물리적인 서버를 임대하는 방식<br>

EC2의 유형과 크기<br>
(1) 유형 => 직업<br>
(2) 사이즈 => 레벨<br>
(각 인스턴스 별로 사용 목적에 따라 최적화 : 메모리 위주, CPU 위주, 그래픽 카드 위주)<br>
(3) 타입별로 이름 부여 (t타입, m타입, inf타입)<br>
(4) 타입별 세대별로 숫자 부여 (m5 = m인스턴스 5세대)<br>
(5) 아키텍쳐 및 사용 기술에 따라 접두사<br>
t4g = t4인스턴스 중 AWS Graviton 프로세서를 사용(g)<br>
![img](../Img/instance3.png)

크기 : 인스턴스의 CPU갯수, 메모리 크기, 성능 등으로 사이즈를 결정<br>
![img](../Img/instance2.png)
크기가 클 수록 cpu 갯수, 메모리 크기가 커지는걸 볼 수 있다.

m5a.xlarge = 인스턴스타입-세대-접두사 . 사이즈<br>

EBS : EC2 인스턴스에 사용할 영구 블록 스토리지 볼륨 (가상 하드 드라이브)<br>
(1) 인스턴스가 종료되어도 계속 유지 가능<br>
(인스턴스랑 EBS는 분리 되어 네트워크로 통신한다.)<br>
(2) EC2와 같은 가용 영역이 존재<br>
(3) 5가지 타입을 제공<br>
( 범용(SSD), 프로비저닝 된 IOPS, 쓰루풋 최적화, 콜드 HDD, 마그네틱 )<br>
![img](../Img/EBS.png)

Snapshot : 특정 시간에 EBS 상태를 저장함 (복구용)<br>
S3(AWS 파일 저장소)에 증분식 저장 방식으로 보관한다.<br>
증분식 : 변화된 부분만 저장

AMI : EC2 인스턴스를 실행하기 위해 필요한 정보를 모은 단위<br>
(OS, 아키텍쳐 타입(32bit), 저장공간 용량 등)<br>
AMI를 사용하여 EC2를 복제하거나 다른 리전 or 계정으로 전달 가능<br>
스냅샷을 기반으로 AMI 구성 가능<br>

보안 그룹 : 가상의 방화벽<br>

AMI 구성<br>

1. 1개 이상의 EBS 스냅샷<br>
2. 인스턴스 저장 루트 볼륨에 대한 템플렛(운영체제, 서버)<br>
3. 사용 권한<br>
4. 블록 디바이스 맵핑(EBS가 몇개 붙는지)<br>

AMI 타입<br>
EBS 기반 : EBS와 EBS 볼륨이 네크워크로 연결되어 분리 되어있음 (속도가 느림) <br>[스냅샵을 기반으로 루트 디바이스 생성]<br>
인스턴스 저장 기반 : 인스턴스 저장소에 저장 되어 있음 (속도가 빠름 단, 인스턴스가 삭제되면 같이 삭제됨) <br>[S3에 저장된 템플릿을 기반으로 생성]<br>

AMI 생성 과정<br>
![img](../Img/AMI.png)<br>

## [EC2 생성하기](./EC2.md)

## [EC2 이미지 복제](./EC2_Img.md)

---

## Autoscaling

(Verticla Scale)Scale up (EC2의 성능을 높이는것)<br>
단, 성능을 높여도 똑같이 비용이 비례해서 증가하지 않고 기하급수적으로 비용이 증가할 수 있다.<br>

(Horizontal Scale)Scale out : cpu의 갯수를 늘리는것(인스턴스를 늘리는것)<br>
이럴 경우 성능과 비용이 비례한다.<br>

그리고 Horizontal Scale 서비스를 제공하기 위해
등장한게 Autoscaling이다.<br>

![img](../Img/awsautoscaling.png)<br>

### EC2 Autoscaling의 목표<br>

정확한 수의 EC2 인스턴스를 보유하도록 보장<br>

1. 그룹의 최소 인스턴스 숫자 및 최대 인스턴스 숫자를 설정할 수 있다.
2. 다양한 스케일링 정책 적용 가능 (CPU의 부하에 따라 인스턴스 크기를 늘리기)
3. 가용영역에 인스턴스가 골고루 분산 될 수 있도록 인스턴스를 분배
   (서비스 장애를 최소화 시킬 수 있음)

시작 구성 (무엇을 실행할지 -> 시작 템플릿을 기반으로 생성한다.)<br>

1. EC2의 타입, 사이즈
2. AMI
3. 보안 그룹, Key, IAM
4. 유저 데이터

모니터링 (언제 실행할지, 상태 확인)<br>
예시) CPU 점유율이 일정 수준 넘을때 추가로 실행<br>
CloudWatch 와 ELB가 연계된다.<br>

설정 (얼마나 실행할지)<br>
최대 / 최소 원하는 인스턴스 숫자<br>
ELB와 연동된다.<br>

## [AutoScaling 구성하기](../Document/AutoScaling.md)

---

## ELB (Elastic Load Balancer)

![img](../Img/ELB1.png)<br>
다음과 같이 AutoScaling 기능으로 많은 EC2를 생성했지만 클라이언트에서는 각 EC2의 IP주소를 알아야 사용이 가능하다.<br>
심지어 인스턴스한개를 재생성하면 IP주소가 달라져 관리가 힘들다.<br>

![img](../Img/ELB2.png)<br>
그래서 여러 인스턴스들을 한대로 묶어서 트래픽을 하나의 경로로 분산해주는 LoadBlancer를 제공한다.<br>

결국 하나의 주소로 접속만 해도 Loadbalancer가 알아서 분산해서 연결해준다.<br>

1. 다수의 서비스의 트래픽을 분산 시켜주는 서비스
2. Health Check : 직접 트래픽을 발생시켜 인스턴스가 살아있는지 체크
3. AutoScaling과 연동 가능
4. 여러 가용영역에 분산 가능
5. 지속적으로 IP주소가 바뀌며 IP를 고정할 수 없다.<br>
   (도메인을 기반으로 사용한다.)

## Load Balancer 종류

### Appilcation Load Balancer

트래픽을 모니터링 하여 라우팅 가능<br>
예시) <br>image.sample.com -> 이미지 서버로 전송<br>
web.sample.com -> 웹서버로 전송<br>
하는등의 트래픽 분산이 가능<br>

### Network Load Balancer

TCP 기반 빠른 트래픽 분산, Elastic IP 할당 가능

### Classci Load Balancer

현재는 잘 사용하지 않음

### Gateway Load Balancer

트래픽을 먼저 확인하고 가상 어플라이언스로 배포/확장을 관리하는 서비스<br>

![img](../Img/ELB3.png)<br>
(다음과 같이 트래픽을 검사하고 EC2에 전송한다.)<br>

### (ALB) Appilcation Load Balancer가 라우팅할 집합

구성 <br>

1. 인스턴스
2. Private IP
3. Lambda
4. ALB (다른 ALB)

## [ELB 구성하기](./ELB.md)
